<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project List</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“‹</text></svg>" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN ë§í¬, integrity ì†ì„± ìˆ˜ì • -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
            font-family: 'Inter', sans-serif;
        }
        .filter-btn.active {
            background-color: #4f46e5; /* Indigo */
            color: white;
            /* í™œì„±í™”ëœ ë²„íŠ¼ì— í˜¸ë²„ ì‹œ ê¸°ì¡´ ìƒ‰ìƒë³´ë‹¤ ì‚´ì§ ì§„í•˜ê²Œ ìœ ì§€ (Tailwind indigo-700) */
            background-color: #4338ca !important;
        }
        .filter-btn:hover {
            /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ì˜ ì¼ë°˜ì ì¸ í˜¸ë²„ íš¨ê³¼ */
            background-color: #e2e8f0; /* gray-100 */
        }
        .filter-btn.active:hover {
            /* í™œì„±í™”ëœ ë²„íŠ¼ì˜ í˜¸ë²„ íš¨ê³¼ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì¬ì •ì˜ */
            background-color: #4338ca !important; /* active ìƒ‰ìƒë³´ë‹¤ ì‚´ì§ ì§„í•œ ë‚¨ìƒ‰ */
        }

        .modal-content {
            max-height: 90vh;
        }
        .tag {
            display: inline-block;
            background-color: #e2e8f0;
            color: #475569;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-in-progress { background-color: #dbeafe; color: #1e40af; }
        .status-planned { background-color: #fef3c7; color: #92400e; }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800">Project List</h1>
            <p class="text-lg text-gray-600 mt-2">ì €ì˜ ì—´ì •ê³¼ ë…¸ë ¥ì´ ë‹´ê¸´ í”„ë¡œì íŠ¸ë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section id="filter-section" class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-center">í”„ë¡œì íŠ¸ ë‘˜ëŸ¬ë³´ê¸°</h2>
            <div id="filter-buttons" class="flex justify-center flex-wrap gap-3">
                <button class="filter-btn active px-6 py-2 rounded-full font-semibold text-gray-700 bg-white shadow-md transition hover:bg-gray-100" data-status="All">ì „ì²´</button>
                <button class="filter-btn px-6 py-2 rounded-full font-semibold text-gray-700 bg-white shadow-md transition hover:bg-gray-100" data-status="ì™„ë£Œ">ì™„ë£Œ</button>
                <button class="filter-btn px-6 py-2 rounded-full font-semibold text-gray-700 bg-white shadow-md transition hover:bg-gray-100" data-status="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</button>
                <button class="filter-btn px-6 py-2 rounded-full font-semibold text-gray-700 bg-white shadow-md transition hover:bg-gray-100" data-status="ê³„íšì¤‘">ê³„íšì¤‘</button>
            </div>
        </section>

        <section id="project-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="project-card-skeleton bg-white rounded-lg shadow-lg overflow-hidden animate-pulse">
                <div class="w-full h-48 bg-gray-300"></div>
                <div class="p-6">
                    <div class="h-6 w-3/4 bg-gray-300 rounded mb-4"></div>
                    <div class="h-4 w-full bg-gray-300 rounded mb-2"></div>
                    <div class="h-4 w-1/2 bg-gray-300 rounded"></div>
                    <div class="flex flex-wrap mt-4">
                        <div class="h-6 w-16 bg-gray-300 rounded-full mr-2"></div>
                        <div class="h-6 w-20 bg-gray-300 rounded-full"></div>
                    </div>
                </div>
            </div>
            </section>
    </main>

    <div id="project-modal" class="fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center p-4 hidden z-50">
        <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-3xl relative flex flex-col" style="max-height: 90vh;">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-400 transition text-2xl z-[100]">
                <i class="fas fa-times"></i>
            </button>
            <div id="modal-body-scrollable" class="p-8 md:p-12 overflow-y-auto flex-grow">
                <div id="modal-body">
                    </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = 'https://projectlist-backend-production.up.railway.app/api/projects';
            const projectGrid = document.getElementById('project-grid');
            const modal = document.getElementById('project-modal');
            const modalBody = document.getElementById('modal-body');
            const closeModalBtn = document.getElementById('close-modal');
            const filterButtonsContainer = document.getElementById('filter-buttons');

            let allProjects = [];
            let modalOpen = false; // ëª¨ë‹¬ ì—´ë¦¼ ìƒíƒœ ì¶”ì  ë³€ìˆ˜

            // APIì—ì„œ í”„ë¡œì íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            async function fetchProjects() {
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    allProjects = await response.json();
                    renderProjects(allProjects);
                } catch (error) {
                    console.error('Error fetching projects:', error);
                    projectGrid.innerHTML = `<p class="text-center text-red-500 col-span-full">í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>`;
                }
            }
            
            // í”„ë¡œì íŠ¸ë¥¼ ê·¸ë¦¬ë“œì— ë Œë”ë§
            function renderProjects(projectsToRender) {
                projectGrid.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ë˜ëŠ” ìŠ¤ì¼ˆë ˆí†¤ ì§€ìš°ê¸°
                if (projectsToRender.length === 0) {
                    projectGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">í•´ë‹¹ ìƒíƒœì˜ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                    return;
                }

                projectsToRender.forEach(project => {
                    const card = document.createElement('div');
                    card.className = 'project-card bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer';
                    card.dataset.projectId = project.id;
                    
                    const technologiesHTML = project.technologies.split(',').map(tech => `<span class="tag">${tech.trim()}</span>`).join('');
                    
                    let statusClass = '';
                    let statusText = project.status || 'ì•Œ ìˆ˜ ì—†ìŒ';
                    if (statusText === 'ì™„ë£Œ') statusClass = 'status-completed';
                    else if (statusText === 'ì§„í–‰ì¤‘') statusClass = 'status-in-progress';
                    else if (statusText === 'ê³„íšì¤‘') statusClass = 'status-planned';

                    card.innerHTML = `
                        <img src="${project.imageUrl || 'https://placehold.co/400x250/cccccc/FFFFFF?text=Image+Not+Found'}" alt="${project.title}" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <div class="flex justify-between items-center">
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <h3 class="text-xl font-bold mt-2">${project.title}</h3>
                            <p class="mt-2 text-gray-600 text-sm h-10 overflow-hidden">${project.description}</p>
                            <div class="mt-2 text-sm text-gray-500">
                                <span class="font-medium">ê¸°ìˆ :</span> ${project.technologies}
                            </div>
                        </div>
                    `;
                    projectGrid.appendChild(card);
                });
            }

            // ëª¨ë‹¬ì— í”„ë¡œì íŠ¸ ì„¸ë¶€ ì •ë³´ í‘œì‹œ
            function showModal(projectId) {
                const project = allProjects.find(p => p.id === parseInt(projectId));
                if (!project) return;
                
                const technologiesHTML = project.technologies.split(',').map(tech => `<span class="tag">${tech.trim()}</span>`).join('');
                const startDate = project.startDate ? new Date(project.startDate).toLocaleDateString('ko-KR') : 'ë¯¸ì •';
                const endDate = project.endDate ? new Date(project.endDate).toLocaleDateString('ko-KR') : 'ì§„í–‰ì¤‘';
                modalBody.innerHTML = `
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">${project.title}</h2>
                    <img src="${project.imageUrl || 'https://placehold.co/800x450/cccccc/FFFFFF?text=Image+Not+Found'}" alt="${project.title}" class="w-full h-64 object-cover rounded-lg mb-6">
                    <div class="md:col-span-2">
                        <h4 class="font-semibold text-lg mb-2">í”„ë¡œì íŠ¸ ì„¤ëª…</h4>
                        <p class="text-gray-700 whitespace-pre-wrap">${project.description}</p>
                    </div>
                    <div class="mt-6">
                        <h4 class="font-semibold text-lg mb-2">ì‚¬ìš© ê¸°ìˆ </h4>
                        <div class="flex flex-wrap">${technologiesHTML}</div>
                    </div>
                    <div class="mt-6">
                        <h4 class="font-semibold text-lg mb-2">í”„ë¡œì íŠ¸ ì •ë³´</h4>
                        <ul class="text-gray-700 space-y-2">
                            <li><strong>ìƒíƒœ:</strong> ${project.status}</li>
                            <li><strong>ê¸°ê°„:</strong> ${startDate} ~ ${endDate}</li>
                        </ul>
                        <div class="mt-4 flex space-x-4">
                            ${project.projectLink ? `<a href="${project.projectLink}" target="_blank" class="text-white bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg transition flex items-center gap-2"><i class="fas fa-external-link-alt"></i> í”„ë¡œì íŠ¸ ë³´ê¸°</a>` : ''}
                            ${project.githubLink ? `<a href="${project.githubLink}" target="_blank" class="text-gray-700 bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition flex items-center gap-2"><i class="fab fa-github"></i> GitHub</a>` : ''}
                        </div>
                    </div>
                `;
                modal.classList.remove('hidden');
                document.body.classList.add('overflow-hidden'); // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
                
                // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ íˆìŠ¤í† ë¦¬ ìŠ¤íƒì— ìƒíƒœ ì¶”ê°€
                if (!modalOpen) {
                    history.pushState({ modalOpen: true, projectId: projectId }, '', '#project-modal-open');
                    modalOpen = true;
                }

                // ëª¨ë‹¬ ë‚´ìš©ì˜ ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ë™
                const modalBodyScrollable = document.getElementById('modal-body-scrollable');
                if (modalBodyScrollable) {
                    modalBodyScrollable.scrollTop = 0;
                }
            }

            // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            function closeModal() {
                modal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden'); // ë°°ê²½ ìŠ¤í¬ë¡¤ í—ˆìš©
                if (modalOpen) {
                    modalOpen = false;
                }
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            projectGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.project-card');
                if (card) {
                    showModal(card.dataset.projectId);
                }
            });

            closeModalBtn.addEventListener('click', () => {
                // 'X' ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê³  íˆìŠ¤í† ë¦¬ ë˜ëŒë¦¬ê¸°
                closeModal();
                if (history.state && history.state.modalOpen) {
                    history.back(); // ëª¨ë‹¬ì„ ì—´ì—ˆì„ ë•Œ ì¶”ê°€í•œ íˆìŠ¤í† ë¦¬ ìƒíƒœë¥¼ ë˜ëŒë¦¼
                }
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                    if (history.state && history.state.modalOpen) {
                        history.back(); // ëª¨ë‹¬ì„ ì—´ì—ˆì„ ë•Œ ì¶”ê°€í•œ íˆìŠ¤í† ë¦¬ ìƒíƒœë¥¼ ë˜ëŒë¦¼
                    }
                }
            });
            
            filterButtonsContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    // í™œì„± ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const status = e.target.dataset.status;
                    const filteredProjects = (status === 'All') 
                        ? allProjects 
                        : allProjects.filter(p => p.status === status);
                    renderProjects(filteredProjects);
                }
            });

            // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬
            window.addEventListener('popstate', (event) => {
                // modalOpen ìƒíƒœ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë‹¬ì´ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
                // ê·¸ë¦¬ê³  íˆìŠ¤í† ë¦¬ ìƒíƒœì— modalOpen í”Œë˜ê·¸ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (modalOpen && (!event.state || !event.state.modalOpen)) {
                    closeModal();
                    // ì‚¬ìš©ìê°€ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª¨ë‹¬ì´ ë‹«í˜”ìœ¼ë¯€ë¡œ,
                    // í˜„ì¬ URLì„ ë‹¤ì‹œ pushí•˜ì—¬ ì‹¤ì œ í˜ì´ì§€ ì´ë™ì„ ë§‰ìŒ.
                    // ì´ë ‡ê²Œ í•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë‹¬ ë‹«íŒ í›„ í˜ì´ì§€ê°€ ë’¤ë¡œ ì´ë™í•¨.
                    history.pushState(null, '', window.location.pathname + window.location.search);
                } else if (event.state && event.state.modalOpen && !modalOpen) {
                    // ì´ ë¶€ë¶„ì€ í˜„ì¬ ë’¤ë¡œê°€ê¸° ì‹œ ëª¨ë‹¬ ë‹«ê¸°ë§Œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì¶”ê°€ì ì¸ ë¡œì§ ë¶ˆí•„ìš”
                }
            });

            // í˜ì´ì§€ ë¡œë“œ ì‹œ URLì— #project-modal-openì´ ìˆìœ¼ë©´ ëª¨ë‹¬ ìƒíƒœ ì´ˆê¸°í™” (ê°„í˜¹ ë‚¨ì•„ìˆì„ ê²½ìš°)
            if (window.location.hash === '#project-modal-open') {
                history.replaceState(null, '', window.location.pathname + window.location.search);
            }

            // ì´ˆê¸° í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸°
            fetchProjects();
        });
    </script>
</body>
</html>
